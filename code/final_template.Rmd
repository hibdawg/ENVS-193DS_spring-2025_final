---
title: "final_template"
author: "Hibah Ganie"
date: "2025-06-10"
output: html_document
format:
  html:
    toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---

## [Hibah's Github Repository](https://github.com/hibdawg/ENVS-193DS_spring-2025_final)

```{r Reading In Packages}
library(tidyverse) # General use
library(janitor) # Cleaning data Frames
library(dplyr) # Mutate columns
library(lubridate) # make dealing with dates easier
library(here) # File Organization
library(readxl) # reading .xlsx files
library(ggeffects) # generating model predictions
library(gtsummary) # generating summary tables for models 
library(ggplot2) # visualizations
library(hms) # working with times
library(MuMIn) 
library(DHARMa)
```

```{r Reading In Data}
sst <- read_csv(here("data", "SST_update2023.csv")) # read in sea surface temperature data
parrot <- read_csv( 
  # read in data and specify file path
  here("data", "occdist.csv"))
```

# Problem 1. Research Writing

## a.

[In part one they used a correlation test to determine how two variables, distance from headwater (km) and annual total nitrogen load (kg year\^-1) relate or are associated with eachother. My coworker also use an ANOVA in part 2 to compare the means of more than two groups.]

## b.

[Accepting uncertainty is key in interpreting analysis of variance, and can be conducted through communicating the confidence intervals, such as the CI of the difference between urban land, atmospheric deposition, fertilizer, waste water treatment, and grasslands.Tukey's Honestly Signifiant difference can be used to further investigate which groups are different when compares, giving information on pairwise comparison, difference in means between groups, and adjusted p-value to increase transparency.Effect size can also be used to determine how strongly distance from headwaters (KM) effects the annual total nitrogen load (kg year\^-1) found between groups.]

## c.

[We found a negligible difference (n\^2= effect size) between groups in mean nitrogen load (One-Way Anova, F-distribution(among groups Degrees of Freedom,within group Degrees of Freedom) = f-value, p \< 0.02, $\alpha$ = significance level)

On average, there was little difference of nitrogen load between urban land, atmospheric deposition, fertilizer, waste water treatment and grasslands (Tukey HSD difference, % Confidence Interval:[CI, CI](kg%20year%5E-1) based on distance from headwaters (KM)) ]

# Problem 2. Data Visualization

## a. Cleaning and Summarizing

```{r Cleaning SST Data}
sst_clean <- sst |> 
  # select sst data frame
  clean_names() |> 
  # remove spaces and uppercase letters (cleans)
  mutate( # mutate function to change formatting of date, year, and month using lubridate package
    date = ymd(date), #year, month, date formate for date column                    
    year = year(date), # change from chr to num for year  
    month = month(date, label = TRUE, abbr = TRUE) # change month to an ordered factor and abbreviate
  ) |> 
  filter(year >= 2018) |> 
  # filters years to after 2018
  mutate(
    year = factor(year), # convert year to factor
    month = factor(month, levels = month.abb, ordered = TRUE) # month as a factor
  ) |> 
  group_by(year, month) |> 
  # group together year and month for mean monthly SST calculation
  summarise(mean_monthly_sst = 
              mean(temp, na.rm = TRUE),
            .groups = "drop") |> 
  # Calculate mean monthly sst and ignore missing values, then drop the grouping
  mutate(
    mean_monthly_sst = (format(round(mean_monthly_sst, 1), nsmall = 1) # round values to one decimal point
  )) |> 
  # One last mutate to convert from chr to number, or dbl format
  mutate( 
    mean_monthly_sst = 
      as.numeric(mean_monthly_sst)
  )

# Randomly display 5 rows from sst_clean data frame
sst_clean |> 
  slice_sample(n = 5)

#display structure of dataframe
str(sst_clean)
```

```{r Creating Time-Series Visualization}

ggplot(data = sst_clean, # select cleaned data frame
       aes(x=month, # x axis as month
           y=mean_monthly_sst, # y axis as mean monthly sea surface temperature
           group = year,# group by year so a separate line shows up for each year
           color= factor(year))) + # each year as a factor
  geom_line(linewidth = 1) + # select thickness of line
  geom_point(size = 2) + # select size of point
  scale_color_manual( # manually choose colors
    values= c( # c, for list of colors
      "2018" = "#aec7e8",
      "2019" = "#7fc6e8",
      "2020" = "#487db1",
      "2021" = "#2c4d79",
      "2022" = "#1e2f40", 
      "2023" = "#000000"
      )) +
  labs(x = substitute(paste(bold('Month'))), # label x, y, and legend as well as bold
       y = substitute(paste(bold("Mean Monthly Surface Temperature (Â°C)"))),
       color = substitute(paste(bold("Year"))),
       ) +
  theme( # custom theme to remove all elements except add gray border 
    panel.background = element_rect(
      fill = "white",
      colour = NA),       # white panel fill, no border here
    panel.border = element_rect(
      fill = NA, 
      colour = "#808080", 
      size = 1),  # size of border
    plot.background  = element_rect(fill = "white", colour = NA), # remove any color
    panel.grid.major = element_blank(), # make everything blank
    panel.grid.minor = element_blank(),
    axis.ticks        = element_blank()) +
  theme(
    legend.position = c(.16,.95), # position graph in top left corner
    legend.justification = c(.8,1) # specify other corner
  )
```

# Problem 3: Data Analysis

## a.

[The ones in this data set represent an presence of bird within each column, meaning presence of swift parrot, common starling, unoccupied, or tree martin within each categorical column for each species. The 0s indicate that the box for each category is other species, empty, or occupied.]

## b.

[Swift parrots are nomadic, critically endangered due to deforestation and predation, and rarely breed in the same location. The selective nature of swift parrots is different from common starlings and Tree Martins, which are generalists and can easily compete with swift parrots for nest boxes.]

## c.

[The two years the authors looked at were 2016 and 2019 during breeding times for swift parrots stimulated by mast tree flowering event. Swift parrots are not known to occupy repeat breeding sites, so the second season tests how permanent next boxes are utilized by swift parrots and non-target species.]

## d.

| Model number | Season | Distance to Forest Edge | Model Description            |
|:-------------:|:-------------:|:------------------:|------------------------|
|      0       |        |                         | No predictors (null model)   |
|      1       |   X    |            X            | all predictors (full model)  |
|      2       |   X    |                         | Season Only                  |
|      3       |        |            X            | Distance to Forest Edge Only |

## e.

```{r Cleaning Parrot Data}
parrot_clean <- parrot |> 
  clean_names() |> 
   mutate(
    swift_parrot = box_occupant == "swift parrot"
  ) |> 
  mutate(
    season = as.factor(season)
  ) |> 
  select(
    box_occupant,
    edge_distance,
    season,
    swift_parrot
         ) |> 
  mutate(
    swift_parrot = as.factor(swift_parrot)
  )
```

```{r}
# model 0: null model
model0 <- glm(
  swift_parrot ~ 1, # Null model ,no other variables
  data = parrot_clean, # DF
  family = "binomial" # binomial distribution, swift parrot or not
)

#model !: Saturated Model
model1 <- glm(
  swift_parrot ~ season + edge_distance, # account for season and distance from forest
  data = parrot_clean,
  family = "binomial"
)

# model 2: Univariate Model: distance from edge
model2 <- glm(
  swift_parrot ~ season, # Only account for season
  data = parrot_clean,
  family = "binomial"
)

# model 3: Univariate Model: Season
model3 <- glm(
  swift_parrot ~ edge_distance, # only account for distance from edge
  data = parrot_clean,
  family = "binomial" 
)
```

```{r Simulate Residuals}
# Use DHARMa Package to simulate residuals for each model
residuals0 = simulateResiduals(model0)
residuals1 = simulateResiduals(model1)
residuals2 = simulateResiduals(model2)
residuals3 = simulateResiduals(model3)
```
```{r plot Model Diagnostics}
# Use DHARMa Package to plot residuals 
par(mfrow = c(2,2))
plot(residuals0)
```

```{r}
par(mfrow = c(2,2))
plot(residuals1)
```

```{r}
par(mfrow = c(2,2))
plot(residuals2)
```

```{r}
par(mfrow = c(2,2))
plot(residuals3)
```

```{r Select the Best Model: AIC }
AICc(model0,
     model1, # Lowest AIC @ 226.3133
     model2,
     model3) |> 
  # arranging output in descending order of AIC
  arrange(AICc)
```

# G. Select the Best Model
[Determined through Aikaike Information Criterion, the saturated model that considered both season and distance from forest edge was the best fit. The best model predicts swift parrots (species) habitation of nest boxes during breeding season includes season (year) and distance from forest edge (m)]

# H. Visualize Model Predictions
```{r Model 1 Predictions}
mod_preds <- ggpredict(
  model1, # model Object
  terms = c("edge_distance", "season") # predictors
  ) 

ggplot(parrot_clean,
       aes(x = edge_distance,
           y = as.numeric(as.character(swift_parrot)))) +
  geom_point(size = 3,
             alpha = 0.4) + 
  geom_ribbon(data = mod_preds,
              aes(x = x,
                  y = predicted,
                  ymin = conf.low,
                  ymax = conf.high,
                  fill = group),
              alpha = 0.4) + 
  geom_line(data = mod_preds,
            aes(x = x,
                y = predicted,
                color = group),
            size = 1.2,
            inherit.aes = FALSE) +
  scale_y_continuous(limits = c(0,1)) +
  labs(color = "season", fill = "season")
```

